From ead120039655989e3035ef706e7e89c61f8a4637 Mon Sep 17 00:00:00 2001
From: Caio Weslley <CaioWzy@gmail.com>
Date: Sun, 18 Sep 2016 22:31:14 -0300
Subject: [PATCH] Update paste service used by timings.


diff --git a/pom.xml b/pom.xml
index 6dde857..9279624 100644
--- a/pom.xml
+++ b/pom.xml
@@ -144,5 +144,20 @@
             <version>1.3</version>
             <scope>test</scope>
         </dependency>
+        <dependency>
+            <groupId>org.github.paperspigot</groupId>
+            <artifactId>minecraft-server</artifactId>
+            <version>1.7.10-SNAPSHOT</version>
+        </dependency>
+        <dependency>
+            <groupId>org.github.paperspigot</groupId>
+            <artifactId>minecraft-server</artifactId>
+            <version>1.7.10-SNAPSHOT</version>
+        </dependency>
+        <dependency>
+            <groupId>com.google.code.gson</groupId>
+            <artifactId>gson</artifactId>
+            <version>2.2.4</version>
+        </dependency>
     </dependencies>
 </project>
diff --git a/src/main/java/org/bukkit/command/defaults/TimingsCommand.java b/src/main/java/org/bukkit/command/defaults/TimingsCommand.java
index 57f11a5..c55f86f 100644
--- a/src/main/java/org/bukkit/command/defaults/TimingsCommand.java
+++ b/src/main/java/org/bukkit/command/defaults/TimingsCommand.java
@@ -231,14 +231,14 @@ public class TimingsCommand extends BukkitCommand {
                 con.setInstanceFollowRedirects( false );
 
                 OutputStream out = con.getOutputStream();
-                out.write( "poster=Spigot&syntax=text&content=".getBytes( "UTF-8" ) );
-                out.write( URLEncoder.encode( bout.toString( "UTF-8" ), "UTF-8" ).getBytes( "UTF-8" ) );
+                out.write( bout.toByteArray() );
                 out.close();
+
+                com.google.gson.JsonObject location = new com.google.gson.Gson().fromJson(new java.io.InputStreamReader(con.getInputStream()), com.google.gson.JsonObject.class);
                 con.getInputStream().close();
 
-                String location = con.getHeaderField( "Location" );
-                String pasteID = location.substring( "http://paste.ubuntu.com/".length(), location.length() - 1 );
-                sender.sendMessage( ChatColor.GREEN + "View timings results can be viewed at http://aikar.co/timings.php?url=" + pasteID );
+                String pasteID = location.get( "key" ).getAsString();
+                sender.sendMessage( ChatColor.GREEN + "Timings results can be viewed at https://www.spigotmc.org/go/timings?url=" + pasteID );
             } catch ( IOException ex )
             {
                 sender.sendMessage( ChatColor.RED + "Error pasting timings, check your console for more information" );
-- 
2.7.4

